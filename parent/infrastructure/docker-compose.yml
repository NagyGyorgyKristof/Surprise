version: '3.1'
services:

  database:
    image: postgres:12.1
    restart: always
    container_name: surprise-postgres-db
    volumes:
      - ./postgres/init.sql:/docker-entrypoint-initdb.d/init.sql
      - database-data:/var/lib/postgresql/data/
    environment:
      POSTGRES_PASSWORD: root
      POSTGRES_USER: root
      POSTGRES_DB: surprise
    ports:
      - 5432:5432

  #  neo4j:
  #    image: neo4j:4.0.1
  #    container_name: surprise-neo4j-db
  #    restart: unless-stopped
  #    ports:
  #     - 7474:7474
  #     - 7687:7687
  #    volumes:
  #     - ./neo4j/data:/data
  #     - ./neo4j/import:/import
  #     - ./neo4j/conf:/conf
  #     - ./neo4j/plugins:/plugins
  #    environment:
  #        #Raise memory limits
  #     - NEO4J_dbms.memory.pagecache.size=1G
  #     - NEO4J_dbms.memory.heap.initial_size=1G
  #     - NEO4J_dbms.memory.heap.max_size=3G
  #     - NEO4J_dbms.connector.bolt.address=0.0.0.0:7687
  #     - NEO4J_dbms.connector.bolt.enabled=true

  jupyter:
    build:
      context: ./jupyter/docker
    command: start-notebook.sh --NotebookApp.token=''
    container_name: surprise-jupyter
    ports:
      - "8888:8888"
    volumes:
      - "./jupyter/notebooks:/notebooks"
      - "./jupyter/data:/data"
      - "./jupyter/script:/script"
      #TODO kiszerverzni ezt egy kornyezeti valtozoba!
      - "/Users/Kristof/Library/Application Support/Neo4j Desktop/Application/neo4jDatabases/database-d45cad43-5a17-4556-92af-e931e2000be5/installation-4.0.1/import:/import"

#TODO probalgatni meg, hogy innen is menjen a django
#  django:
#    build:
#      context: ./django
#    container_name: surprise-django
#    command: python ./django/src/manage.py runserver 0.0.0.0:8000
#    volumes:
#      - ./django:/code
#      - ./django/script:/script
#    ports:
#      - "8000:8000"

volumes:
  postgres:
  database-data:
  neo4j-data:
